<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hudan Content Plan</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #111827; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #374151; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #ea580c; }
        body { background-color: #000; color: #fff; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        // --- IMPORTS ---
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        
        // Firebase Imports
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";
        import { 
            getAuth, signInAnonymously, onAuthStateChanged 
        } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { 
            getFirestore, collection, addDoc, deleteDoc, doc, updateDoc, onSnapshot, query, orderBy 
        } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
        
        // Icon Imports
        import { 
            Trash2, Wand2, RefreshCw, Dumbbell, Calendar as CalendarIcon, 
            List as ListIcon, Plus, Zap, Layout, ChevronRight
        } from 'https://esm.sh/lucide-react';

        // --- KONFIGURASI FIREBASE BAGINDA ---
        const firebaseConfig = {
            apiKey: "AIzaSyDLoRJjfs9P9a5cvl90VtYHK7ZftW86rYI",
            authDomain: "hudan-content-plan.firebaseapp.com",
            projectId: "hudan-content-plan",
            storageBucket: "hudan-content-plan.firebasestorage.app",
            messagingSenderId: "712334443122",
            appId: "1:712334443122:web:6a43f452504322bd1ef8eb",
            measurementId: "G-DXQJ56VQW2"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = "hudan-content-plan"; // ID Unik untuk koleksi database

        // --- KOMPONEN UI ---

        const FormSelect = ({ label, name, value, options, onChange }) => (
            <div className="relative group mb-4">
                <label className="block text-xs font-semibold text-gray-500 uppercase mb-1.5 ml-1">{label}</label>
                <div className="relative">
                <select 
                    name={name}
                    value={value}
                    onChange={onChange}
                    className="w-full pl-4 pr-8 py-2.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-orange-500/50 rounded-xl text-sm focus:ring-2 focus:ring-orange-900 focus:border-orange-500 outline-none transition-all appearance-none text-gray-200 font-medium"
                >
                    {options}
                </select>
                <div className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none group-hover:text-orange-500 transition-colors">
                    <ChevronRight size={12} className="rotate-90" />
                </div>
                </div>
            </div>
        );

        const SectionHeader = ({ title, icon }) => (
            <div className="flex items-center gap-2 mb-4 pb-2 border-b border-gray-700/50">
                <div className="p-1.5 bg-gray-800 rounded-lg text-orange-500 shadow-sm border border-gray-700">
                {icon}
                </div>
                <h3 className="text-sm font-bold text-gray-300 uppercase tracking-wide">{title}</h3>
            </div>
        );

        const NavItem = ({ icon, label, active, onClick }) => (
            <button 
                onClick={onClick}
                className={`flex items-center gap-2 px-5 py-2.5 rounded-xl transition-all duration-300 ease-out ${
                active 
                    ? 'bg-gray-800 text-white shadow-lg shadow-black/40 border border-gray-700 ring-1 ring-orange-500/50' 
                    : 'text-gray-400 hover:text-white hover:bg-white/5'
                }`}
            >
                <span className={`${active ? 'text-orange-500' : ''}`}>{icon}</span>
                <span className="font-bold text-xs uppercase tracking-wide hidden md:block">{label}</span>
            </button>
        );

        const NavigationTabs = ({ activeTab, setActiveTab }) => (
            <nav className="flex items-center gap-2 bg-gray-900/80 p-1.5 rounded-2xl border border-white/10 backdrop-blur-sm shadow-xl inline-flex overflow-x-auto max-w-full scrollbar-hide justify-center">
                <NavItem icon={<Wand2 size={18} />} label="Generator" active={activeTab === 'generator'} onClick={() => setActiveTab('generator')} />
                <NavItem icon={<ListIcon size={18} />} label="Content Plan" active={activeTab === 'plan'} onClick={() => setActiveTab('plan')} />
                <NavItem icon={<CalendarIcon size={18} />} label="Calendar" active={activeTab === 'calendar'} onClick={() => setActiveTab('calendar')} />
            </nav>
        );

        // --- MAIN APP ---
        function App() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('generator');
            const [prompts, setPrompts] = useState([]);
            const [generatedResult, setGeneratedResult] = useState(null);
            const [isSaving, setIsSaving] = useState(false);

            // State Form
            const [formData, setFormData] = useState({
                aiModel: 'Midjourney',
                platform: 'Instagram/Facebook',
                sportsCategory: 'Futsal',
                subject: '',
                athletePose: '',
                mood: 'Intense',
                visualStyle: 'Photorealistic',
                contentStyle: 'Nike Ad Style',
                lighting: 'Dramatic',
                angle: 'Low Angle'
            });

            // Auth & Database Listener
            useEffect(() => {
                signInAnonymously(auth).then((cred) => setUser(cred.user)).catch(console.error);
                
                // Realtime Listener
                const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'prompts'));
                const unsub = onSnapshot(q, (snapshot) => {
                    const data = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                    // Sort descending (terbaru di atas)
                    data.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    setPrompts(data);
                }, (error) => {
                    console.log("Database permission error:", error);
                });
                return () => unsub();
            }, []);

            const handleInputChange = (e) => {
                setFormData({...formData, [e.target.name]: e.target.value});
            };

            const handleGenerate = () => {
                const { subject, sportsCategory, mood, platform, aiModel, contentStyle } = formData;
                // Logika Prompt Sederhana
                const prompt = `/imagine prompt: ${subject}, ${sportsCategory} context, ${mood} atmosphere, ${contentStyle}, for ${platform} --v 6.0`;
                
                setGeneratedResult({
                    singleLine: prompt,
                    aiModel: aiModel,
                    createdAt: new Date().toISOString()
                });
            };

            const handleSave = async () => {
                if(!generatedResult) return;
                setIsSaving(true);
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'prompts'), {
                        ...formData,
                        fullPrompt: generatedResult.singleLine,
                        status: 'Idea',
                        scheduledDate: '',
                        createdAt: new Date().toISOString()
                    });
                    setIsSaving(false);
                    setActiveTab('plan'); // Pindah tab otomatis
                } catch(e) {
                    console.error("Error saving:", e);
                    alert("Gagal menyimpan. Pastikan Rules Firebase sudah diatur.");
                    setIsSaving(false);
                }
            };

            return (
                <div className="w-full min-h-screen font-sans bg-black text-gray-200 p-4 md:p-8">
                    <div className="max-w-5xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-8">
                            <div className="flex items-center justify-center gap-3 mb-4">
                                <div className="p-3 bg-gradient-to-br from-orange-600 to-red-600 rounded-2xl shadow-lg">
                                    <Dumbbell className="text-white" size={32} />
                                </div>
                                <div className="text-left">
                                    <h1 className="text-2xl font-black tracking-tighter text-white">HUDAN <span className="text-orange-500">CONTENT</span></h1>
                                    <p className="text-[10px] uppercase tracking-widest text-gray-500">Plan & Generator</p>
                                </div>
                            </div>
                            <NavigationTabs activeTab={activeTab} setActiveTab={setActiveTab} />
                        </div>

                        {/* TAB: GENERATOR */}
                        {activeTab === 'generator' && (
                            <div className="grid md:grid-cols-2 gap-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                <div className="bg-gray-900 p-6 rounded-3xl border border-gray-800">
                                    <SectionHeader title="Konfigurasi" icon={<Zap size={16}/>} />
                                    
                                    <FormSelect label="Kategori" name="sportsCategory" value={formData.sportsCategory} onChange={handleInputChange} 
                                        options={<><option>Futsal</option><option>Sepak Bola</option><option>Gym/Fitness</option></>} 
                                    />
                                    <FormSelect label="Mood" name="mood" value={formData.mood} onChange={handleInputChange} 
                                        options={<><option>Intense</option><option>Victory</option><option>Dark</option></>} 
                                    />
                                    
                                    <div className="mb-4">
                                        <label className="block text-xs font-semibold text-gray-500 uppercase mb-1.5 ml-1">Subjek</label>
                                        <textarea name="subject" onChange={handleInputChange} value={formData.subject} rows="3" className="w-full bg-gray-800 border border-gray-700 rounded-xl p-3 text-sm focus:border-orange-500 outline-none" placeholder="Deskripsikan ide konten..."></textarea>
                                    </div>

                                    <button onClick={handleGenerate} className="w-full py-4 bg-gradient-to-r from-orange-600 to-red-600 rounded-xl font-bold text-white shadow-lg hover:shadow-orange-900/50 transition-all flex items-center justify-center gap-2">
                                        <Wand2 size={20} /> Generate Prompt
                                    </button>
                                </div>

                                <div className="space-y-4">
                                    {generatedResult ? (
                                        <div className="bg-gray-800 p-6 rounded-3xl border border-gray-700">
                                            <div className="text-green-400 text-xs font-bold mb-2 uppercase">Result Ready</div>
                                            <code className="block bg-black/40 p-4 rounded-xl text-green-300 text-sm font-mono break-words mb-4">
                                                {generatedResult.singleLine}
                                            </code>
                                            <button onClick={handleSave} disabled={isSaving} className="w-full py-3 bg-gray-700 hover:bg-gray-600 rounded-xl font-bold text-white flex justify-center items-center gap-2">
                                                {isSaving ? <RefreshCw className="animate-spin"/> : <Plus/>} Simpan ke Plan
                                            </button>
                                        </div>
                                    ) : (
                                        <div className="h-full border-2 border-dashed border-gray-800 rounded-3xl flex flex-col items-center justify-center text-gray-600 p-8">
                                            <Dumbbell size={40} className="mb-4 opacity-20"/>
                                            <p className="text-sm">Prompt akan muncul di sini</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* TAB: CONTENT PLAN (DATABASE) */}
                        {activeTab === 'plan' && (
                            <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {prompts.map(p => (
                                        <div key={p.id} className="bg-gray-900 border border-gray-800 p-5 rounded-2xl hover:border-orange-500/30 transition-all group">
                                            <div className="flex justify-between items-start mb-2">
                                                <span className="text-[10px] font-bold uppercase bg-gray-800 px-2 py-1 rounded text-gray-400 border border-gray-700">{p.status || 'Idea'}</span>
                                                <button onClick={() => deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'prompts', p.id))} className="text-gray-600 hover:text-red-500"><Trash2 size={14}/></button>
                                            </div>
                                            <h3 className="font-bold text-white mb-1 line-clamp-1">{p.subject || "Tanpa Judul"}</h3>
                                            <p className="text-xs text-gray-500 line-clamp-2 mb-3 font-mono bg-black/20 p-2 rounded">{p.fullPrompt}</p>
                                            <div className="flex items-center gap-2 text-[10px] text-gray-400">
                                                <Layout size={10}/> {p.platform}
                                            </div>
                                        </div>
                                    ))}
                                    {prompts.length === 0 && (
                                        <div className="col-span-full text-center py-20 text-gray-600">Belum ada data di database.</div>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {/* TAB: CALENDAR */}
                        {activeTab === 'calendar' && (
                            <div className="text-center py-20 bg-gray-900 rounded-3xl border border-gray-800">
                                <CalendarIcon size={48} className="mx-auto text-gray-700 mb-4"/>
                                <h3 className="text-xl font-bold text-gray-300">Calendar View</h3>
                                <p className="text-gray-500 text-sm mt-2">Fitur kalender akan membaca data tanggal dari Content Plan.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>