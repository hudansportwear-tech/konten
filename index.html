<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hudan Content Plan</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #111827; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #374151; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #ea580c; }
        body { background-color: #000; color: #fff; }
        
        /* Animasi tambahan */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        // --- IMPORTS DARI CDN (Agar jalan tanpa install apapun) ---
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        
        // Firebase Imports (Versi CDN)
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";
        import { 
            getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged 
        } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { 
            getFirestore, collection, addDoc, deleteDoc, doc, updateDoc, onSnapshot, query, orderBy 
        } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';
        
        // Icon Imports
        import { 
            Copy, Trash2, Save, Wand2, Search, Filter, X, RefreshCw,
            Dumbbell, Video, Image as ImageIcon, Share2, Zap, Layout,
            Palette, Camera, Calendar as CalendarIcon, List as ListIcon, 
            Plus, Clock, CheckCircle, MoreVertical, ChevronLeft,
            ChevronRight, PenTool, AlertCircle, Users
        } from 'https://esm.sh/lucide-react';

        // --- KONFIGURASI FIREBASE BAGINDA ---
        const firebaseConfig = {
            apiKey: "AIzaSyDLoRJjfs9P9a5cvl90VtYHK7ZftW86rYI",
            authDomain: "hudan-content-plan.firebaseapp.com",
            projectId: "hudan-content-plan",
            storageBucket: "hudan-content-plan.firebasestorage.app",
            messagingSenderId: "712334443122",
            appId: "1:712334443122:web:6a43f452504322bd1ef8eb",
            measurementId: "G-DXQJ56VQW2"
        };

        const app = initializeApp(firebaseConfig);
        
        // Analytics Safe Init
        let analytics;
        try { analytics = getAnalytics(app); } catch (e) { console.warn("Analytics skipped"); }

        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = "hudan-content-plan";

        // --- KOMPONEN UI ---

        const FormSelect = ({ label, name, value, options, onChange }) => (
            <div className="relative group">
                <label className="block text-xs font-semibold text-gray-500 uppercase mb-1.5 ml-1">{label}</label>
                <div className="relative">
                <select 
                    name={name}
                    value={value}
                    onChange={onChange}
                    className="w-full pl-4 pr-8 py-2.5 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-orange-500/50 rounded-xl text-sm focus:ring-2 focus:ring-orange-900 focus:border-orange-500 outline-none transition-all appearance-none text-gray-200 font-medium"
                >
                    {options}
                </select>
                <div className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none group-hover:text-orange-500 transition-colors">
                    <ChevronRight size={12} className="rotate-90" />
                </div>
                </div>
            </div>
        );

        const SectionHeader = ({ title, icon }) => (
            <div className="flex items-center gap-2 mb-4 pb-2 border-b border-gray-700/50">
                <div className="p-1.5 bg-gray-800 rounded-lg text-orange-500 shadow-sm border border-gray-700">
                {icon}
                </div>
                <h3 className="text-sm font-bold text-gray-300 uppercase tracking-wide">{title}</h3>
            </div>
        );

        const NavItem = ({ icon, label, active, onClick }) => (
            <button 
                onClick={onClick}
                className={`flex items-center gap-2 px-5 py-2.5 rounded-xl transition-all duration-300 ease-out ${
                active 
                    ? 'bg-gray-800 text-white shadow-lg shadow-black/40 border border-gray-700 ring-1 ring-orange-500/50' 
                    : 'text-gray-400 hover:text-white hover:bg-white/5'
                }`}
            >
                <span className={`${active ? 'text-orange-500' : ''}`}>{icon}</span>
                <span className="font-bold text-xs uppercase tracking-wide hidden md:block">{label}</span>
            </button>
        );

        const NavigationTabs = ({ activeTab, setActiveTab }) => (
            <nav className="flex items-center gap-2 bg-gray-900/80 p-1.5 rounded-2xl border border-white/10 backdrop-blur-sm shadow-xl inline-flex overflow-x-auto max-w-full scrollbar-hide justify-center">
                <NavItem icon={<Wand2 size={18} />} label="Generator" active={activeTab === 'generator'} onClick={() => setActiveTab('generator')} />
                <NavItem icon={<ListIcon size={18} />} label="Content Plan" active={activeTab === 'plan'} onClick={() => setActiveTab('plan')} />
                <NavItem icon={<CalendarIcon size={18} />} label="Calendar" active={activeTab === 'calendar'} onClick={() => setActiveTab('calendar')} />
            </nav>
        );

        // --- VIEW COMPONENTS ---

        // 1. Generator View
        const GeneratorView = ({ formData, handleInputChange, handleGenerate, generatedResult, isSaving, handleSave, copyToClipboard }) => {
            return (
                <div className="max-w-7xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                        {/* Form */}
                        <div className="lg:col-span-7 space-y-6">
                            <div className="bg-gray-900/80 backdrop-blur-lg rounded-[2rem] shadow-2xl border border-white/5 p-6 md:p-8 relative overflow-hidden">
                                
                                {/* Core Settings */}
                                <div>
                                <SectionHeader title="Core Strategy" icon={<Zap size={16} />} />
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <FormSelect label="AI Model" name="aiModel" value={formData.aiModel} onChange={handleInputChange}
                                    options={<>
                                        <option value="">Pilih Model...</option>
                                        <optgroup label="ðŸ–¼ï¸ Image Generators">
                                            <option value="Midjourney">Midjourney (v6)</option>
                                            <option value="Stable Diffusion">Stable Diffusion XL</option>
                                            <option value="DALL-E">DALL-E 3</option>
                                            <option value="Flux">Flux.1</option>
                                        </optgroup>
                                        <optgroup label="ðŸŽ¬ Video Generators">
                                            <option value="Sora">Sora</option>
                                            <option value="Runway">Runway Gen-3</option>
                                            <option value="Luma">Luma Dream Machine</option>
                                            <option value="Kling">Kling AI</option>
                                        </optgroup>
                                    </>} />
                                    <FormSelect label="Format" name="platform" value={formData.platform} onChange={handleInputChange}
                                    options={<>
                                        <option value="">Pilih Format...</option>
                                        <option value="Instagram/Facebook">Instagram Feed (1:1)</option>
                                        <option value="Instagram Portrait">Instagram Portrait (4:5)</option>
                                        <option value="TikTok/Reels">Stories/Reels (9:16)</option>
                                        <option value="YouTube Sports">YouTube Landscape (16:9)</option>
                                    </>} />
                                </div>
                                </div>

                                {/* Context */}
                                <div className="mt-8 bg-black/20 p-6 rounded-2xl border border-white/5">
                                    <SectionHeader title="Sport Context" icon={<Layout size={16} />} />
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <FormSelect label="Category" name="sportsCategory" value={formData.sportsCategory} onChange={handleInputChange}
                                        options={<>
                                            <option value="">Pilih Cabang...</option>
                                            <optgroup label="Main">
                                                <option value="Futsal">Futsal</option>
                                                <option value="Football/Soccer">Sepak Bola</option>
                                                <option value="Gym/Bodybuilding">Gym/Fitness</option>
                                                <option value="Badminton">Badminton</option>
                                            </optgroup>
                                            <optgroup label="Other">
                                                <option value="Running">Lari/Marathon</option>
                                                <option value="Swimming">Renang</option>
                                                <option value="Basketball">Basket</option>
                                                <option value="Pencak Silat">Pencak Silat</option>
                                            </optgroup>
                                        </>} />
                                        
                                        <FormSelect label="Mood" name="mood" value={formData.mood} onChange={handleInputChange}
                                        options={<>
                                            <option value="">Pilih Mood...</option>
                                            <option value="Intense">Tegang / Serius</option>
                                            <option value="Victory">Perayaan / Menang</option>
                                            <option value="Focus">Fokus Penuh</option>
                                            <option value="Gritty">Keras / Tangguh</option>
                                            <option value="Dark">Gelap / Dramatis</option>
                                            <option value="Energetic">Enerjik / Ceria</option>
                                        </>} />
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                         <FormSelect label="Style" name="contentStyle" value={formData.contentStyle} onChange={handleInputChange}
                                            options={<>
                                                <option value="">Gaya Visual...</option>
                                                <option value="Nike Ad Style">Nike Style (High Contrast)</option>
                                                <option value="Adidas">Adidas Urban</option>
                                                <option value="Cinematic">Cinematic</option>
                                                <option value="Photorealistic">Realistik</option>
                                                <option value="Anime">Anime</option>
                                                <option value="Cyberpunk">Cyberpunk</option>
                                            </>} 
                                        />
                                        <FormSelect label="Angle" name="angle" value={formData.angle} onChange={handleInputChange}
                                            options={<>
                                                <option value="">Angle...</option>
                                                <option value="Low Angle">Low Angle (Heroic)</option>
                                                <option value="High Angle">High Angle</option>
                                                <option value="Close-up">Close Up</option>
                                                <option value="Wide Shot">Wide Shot</option>
                                                <option value="Drone">Drone View</option>
                                            </>} 
                                        />
                                    </div>
                                    
                                    <div className="relative">
                                        <label className="block text-xs font-semibold text-gray-500 uppercase mb-2 ml-1">Detail Subject / Pose</label>
                                        <textarea
                                            name="subject"
                                            value={formData.subject}
                                            onChange={handleInputChange}
                                            rows={2}
                                            placeholder="Contoh: Kiper sedang terbang menepis bola, background hujan..."
                                            className="w-full px-4 py-3 bg-gray-800 border-2 border-gray-700 rounded-xl focus:ring-2 focus:ring-orange-900 focus:border-orange-500 outline-none transition-all resize-none text-gray-200 text-sm placeholder-gray-600"
                                        ></textarea>
                                    </div>
                                </div>

                                <button onClick={handleGenerate} className="mt-8 w-full py-5 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 text-white text-lg font-black tracking-wide uppercase rounded-2xl shadow-xl hover:shadow-orange-900/50 transition-all flex items-center justify-center gap-3 group">
                                    <Wand2 size={24} className="group-hover:rotate-12 transition-transform" /> Generate Prompt
                                </button>
                            </div>
                        </div>

                        {/* Result */}
                        <div className="lg:col-span-5">
                            {generatedResult ? (
                                <div className="bg-gray-900 rounded-[2rem] border border-orange-500/30 p-6 md:p-8 sticky top-8 shadow-2xl animate-in slide-in-from-bottom-4">
                                    <div className="flex items-center justify-between mb-6">
                                        <div className="flex items-center gap-3">
                                            <div className="h-3 w-3 rounded-full bg-emerald-500 animate-pulse"></div>
                                            <span className="text-xs font-bold text-white uppercase tracking-wider">Result Ready</span>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => copyToClipboard(generatedResult.singleLine)} className="p-2 hover:bg-gray-800 rounded-lg text-gray-400 hover:text-white transition-colors" title="Copy"><Copy size={18}/></button>
                                        </div>
                                    </div>

                                    <div className="bg-black/50 p-5 rounded-2xl border border-gray-800 mb-6 relative group">
                                        <code className="text-sm text-emerald-400 font-mono leading-relaxed break-words block">
                                            {generatedResult.singleLine}
                                        </code>
                                    </div>

                                    <button onClick={handleSave} disabled={isSaving} className="w-full py-4 bg-gray-800 hover:bg-gray-700 border border-gray-700 text-white font-bold rounded-xl flex items-center justify-center gap-2 transition-all group">
                                        {isSaving ? <RefreshCw className="animate-spin" size={20}/> : <Plus size={20} className="group-hover:scale-110 transition-transform" />}
                                        Add to Content Plan (Shared)
                                    </button>
                                </div>
                            ) : (
                                <div className="h-[400px] flex flex-col items-center justify-center text-gray-600 p-8 border-2 border-dashed border-gray-800 rounded-[2rem] sticky top-8">
                                    <div className="p-6 bg-gray-900 rounded-full mb-4">
                                        <Dumbbell size={40} className="text-gray-700" />
                                    </div>
                                    <p className="text-sm font-medium">Prompt akan muncul di sini</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // 3. Content Plan View
        const ContentPlanView = ({ prompts, onUpdateStatus, onDelete, onAddManual }) => {
            const [filterStatus, setFilterStatus] = useState('All');
            const [showAddModal, setShowAddModal] = useState(false);
            const [newIdea, setNewIdea] = useState({ subject: '', description: '', platform: 'Instagram/Facebook' });

            const statusColors = {
                'Idea': 'bg-gray-800 text-gray-300 border-gray-700',
                'Scheduled': 'bg-blue-900/30 text-blue-300 border-blue-800',
                'Published': 'bg-emerald-900/30 text-emerald-300 border-emerald-800'
            };

            const handleAddSubmit = (e) => {
                e.preventDefault();
                if(!newIdea.subject) return;
                onAddManual(newIdea);
                setShowAddModal(false);
                setNewIdea({ subject: '', description: '', platform: 'Instagram/Facebook' });
            };

            const filtered = filterStatus === 'All' ? prompts : prompts.filter(p => (p.status || 'Idea') === filterStatus);

            return (
                <div className="max-w-7xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500 relative">
                    <div className="flex flex-col md:flex-row items-center justify-center relative mb-8 gap-4">
                        <div className="flex gap-1 bg-gray-900/80 p-1.5 rounded-2xl border border-gray-800 backdrop-blur-sm z-10">
                            {['All', 'Idea', 'Scheduled', 'Published'].map(s => (
                                <button key={s} onClick={() => setFilterStatus(s)} className={`px-6 py-2 rounded-xl text-xs font-bold transition-all ${filterStatus === s ? 'bg-orange-600 text-white shadow-lg' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}>
                                    {s}
                                </button>
                            ))}
                        </div>
                        <div className="w-full md:w-auto md:absolute md:right-0 z-0">
                            <button onClick={() => setShowAddModal(true)} className="w-full md:w-auto px-5 py-2.5 bg-orange-600 hover:bg-orange-500 text-white rounded-xl font-bold flex items-center justify-center gap-2 shadow-lg text-xs uppercase tracking-wide">
                                <Plus size={16} /> New Idea
                            </button>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {filtered.map(p => (
                            <div key={p.id} className="bg-gray-900/80 border border-gray-800 rounded-2xl p-5 hover:border-orange-500/30 transition-all group hover:shadow-xl backdrop-blur-sm relative overflow-hidden">
                                {p.aiModel === 'Manual' && <div className="absolute top-0 right-0 w-16 h-16 bg-gradient-to-bl from-blue-500/20 to-transparent pointer-events-none rounded-bl-3xl"></div>}
                                
                                <div className="flex justify-between items-start mb-4 relative z-10">
                                    <span className={`px-3 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wide border ${statusColors[p.status || 'Idea']}`}>{p.status || 'Idea'}</span>
                                    <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                        <button onClick={() => onDelete(p.id)} className="p-2 text-gray-500 hover:text-red-500 hover:bg-red-500/10 rounded-lg transition-colors"><Trash2 size={16}/></button>
                                    </div>
                                </div>
                                
                                <h3 className="text-white font-bold mb-2 line-clamp-1 text-lg flex items-center gap-2">
                                    {p.aiModel === 'Manual' && <PenTool size={14} className="text-blue-400" />}
                                    {p.subject || "Untitled Content"}
                                </h3>
                                <div className="bg-black/30 p-3 rounded-xl border border-white/5 mb-4 h-20 overflow-hidden">
                                    <p className="text-xs text-gray-400 font-mono line-clamp-3">{p.fullPrompt}</p>
                                </div>
                                
                                <div className="pt-4 border-t border-gray-800 flex flex-col gap-3">
                                    <div className="flex items-center gap-3">
                                        <div className="text-gray-500"><Clock size={16} /></div>
                                        <input type="date" value={p.scheduledDate || ''} onChange={(e) => onUpdateStatus(p.id, { scheduledDate: e.target.value })}
                                            className="bg-gray-950/50 border border-gray-700 rounded-lg px-3 py-2 text-xs text-gray-300 focus:border-orange-500 outline-none w-full font-medium" />
                                    </div>
                                    <select value={p.status || 'Idea'} onChange={(e) => onUpdateStatus(p.id, { status: e.target.value })}
                                        className="bg-gray-950/50 border border-gray-700 rounded-lg px-3 py-2.5 text-xs text-gray-300 focus:border-orange-500 outline-none w-full font-bold uppercase cursor-pointer">
                                        <option value="Idea">Idea</option>
                                        <option value="Scheduled">Scheduled</option>
                                        <option value="Published">Published</option>
                                    </select>
                                </div>
                            </div>
                        ))}
                    </div>
                    {filtered.length === 0 && (
                        <div className="text-center py-32 bg-gray-900/30 border-2 border-dashed border-gray-800 rounded-[2rem]">
                            <p className="text-gray-500 font-medium">Tidak ada konten di status ini.</p>
                        </div>
                    )}

                    {/* Add Modal */}
                    {showAddModal && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-gray-900 border border-gray-800 rounded-3xl p-8 w-full max-w-lg shadow-2xl relative">
                                <button onClick={() => setShowAddModal(false)} className="absolute top-4 right-4 text-gray-500 hover:text-white"><X size={20} /></button>
                                <h3 className="text-2xl font-black text-white mb-6">Manual Input</h3>
                                <form onSubmit={handleAddSubmit} className="space-y-5">
                                    <input autoFocus type="text" value={newIdea.subject} onChange={e => setNewIdea({...newIdea, subject: e.target.value})}
                                        className="w-full bg-gray-950 border-2 border-gray-800 rounded-xl px-4 py-3.5 text-white focus:border-blue-500 outline-none" placeholder="Judul / Topik..." />
                                    <textarea value={newIdea.description} onChange={e => setNewIdea({...newIdea, description: e.target.value})}
                                        className="w-full bg-gray-950 border-2 border-gray-800 rounded-xl px-4 py-3.5 text-white focus:border-blue-500 outline-none resize-none" rows={4} placeholder="Deskripsi brief..." />
                                    <select value={newIdea.platform} onChange={e => setNewIdea({...newIdea, platform: e.target.value})}
                                        className="w-full bg-gray-950 border-2 border-gray-800 rounded-xl px-4 py-3.5 text-white focus:border-blue-500 outline-none">
                                        <option>Instagram/Facebook</option>
                                        <option>TikTok/Reels</option>
                                        <option>YouTube</option>
                                    </select>
                                    <button type="submit" className="w-full py-3.5 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold">Simpan Ide</button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 4. Calendar View
        const CalendarView = ({ prompts }) => {
            const today = new Date();
            const [currentMonth, setCurrentMonth] = useState(new Date(today.getFullYear(), today.getMonth(), 1));
            const [selectedEvent, setSelectedEvent] = useState(null);

            const getDaysInMonth = (date) => new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
            const getFirstDayOfMonth = (date) => new Date(date.getFullYear(), date.getMonth(), 1).getDay();

            const daysInMonth = getDaysInMonth(currentMonth);
            const firstDay = getFirstDayOfMonth(currentMonth);
            const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
            const blanks = Array.from({ length: firstDay }, (_, i) => i);

            const nextMonth = () => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1));
            const prevMonth = () => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1));

            const getEventsForDay = (day) => {
                const dateStr = `${currentMonth.getFullYear()}-${String(currentMonth.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                return prompts.filter(p => p.scheduledDate === dateStr);
            };

            return (
                <div className="max-w-7xl mx-auto h-full flex flex-col animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div className="flex items-center justify-end mb-6">
                        <div className="flex items-center gap-6 bg-gray-900/80 p-2.5 rounded-2xl border border-gray-800 backdrop-blur-sm">
                            <button onClick={prevMonth} className="p-2 hover:bg-gray-800 rounded-xl text-gray-400 hover:text-white"><ChevronLeft size={24}/></button>
                            <span className="font-bold text-white text-xl w-48 text-center">{currentMonth.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' })}</span>
                            <button onClick={nextMonth} className="p-2 hover:bg-gray-800 rounded-xl text-gray-400 hover:text-white"><ChevronRight size={24}/></button>
                        </div>
                    </div>

                    <div className="bg-gray-900/80 border border-gray-800 rounded-[2rem] p-6 flex-1 flex flex-col shadow-2xl backdrop-blur-sm">
                        <div className="grid grid-cols-7 mb-6">
                            {['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'].map(d => (
                                <div key={d} className="text-center text-xs font-bold text-gray-500 uppercase tracking-widest">{d}</div>
                            ))}
                        </div>
                        <div className="grid grid-cols-7 gap-px bg-gray-800 border border-gray-800 flex-1 rounded-xl overflow-hidden">
                            {blanks.map(b => <div key={`blank-${b}`} className="bg-gray-900/40 min-h-[140px]"></div>)}
                            {days.map(day => {
                                const events = getEventsForDay(day);
                                return (
                                    <div key={day} className="bg-gray-900/60 min-h-[140px] p-3 hover:bg-gray-800/80 transition-colors group">
                                        <div className="text-sm font-bold text-gray-400 mb-2">{day}</div>
                                        <div className="space-y-1">
                                            {events.map(ev => (
                                                <div key={ev.id} onClick={() => setSelectedEvent(ev)} className="text-[10px] px-2 py-1 rounded bg-gray-800 border border-gray-700 text-gray-300 truncate cursor-pointer hover:border-orange-500">
                                                    {ev.subject || 'Untitled'}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App ---
        function App() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('generator');
            const [prompts, setPrompts] = useState([]);
            const [deleteTargetId, setDeleteTargetId] = useState(null);
            const [formData, setFormData] = useState({
                aiModel: 'Midjourney', platform: 'Instagram/Facebook', sportsCategory: 'Futsal',
                subject: '', athletePose: '', mood: 'Intense', contentStyle: 'Nike Ad Style', angle: 'Low Angle'
            });
            const [generatedResult, setGeneratedResult] = useState(null);
            const [toast, setToast] = useState(null);
            const [isSaving, setIsSaving] = useState(false);

            useEffect(() => {
                signInAnonymously(auth).then(cred => setUser(cred.user));
                const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'prompts'));
                const unsub = onSnapshot(q, (snapshot) => {
                    const data = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                    data.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    setPrompts(data);
                });
                return () => unsub();
            }, []);

            const showToast = (message, type = 'success') => {
                setToast({ message, type });
                setTimeout(() => setToast(null), 3000);
            };

            const copyToClipboard = async (text) => {
                await navigator.clipboard.writeText(text);
                showToast('Copied to clipboard!');
            };

            const handleInputChange = (e) => setFormData({...formData, [e.target.name]: e.target.value});

            const handleGenerate = () => {
                const { subject, sportsCategory, mood, platform, aiModel, contentStyle } = formData;
                const prompt = `/imagine prompt: ${subject}, ${sportsCategory} context, ${mood} atmosphere, ${contentStyle}, for ${platform} --v 6.0`;
                setGeneratedResult({ singleLine: prompt, aiModel, createdAt: new Date().toISOString() });
                showToast('Prompt berhasil dibuat!');
            };

            const handleSave = async () => {
                if(!generatedResult) return;
                setIsSaving(true);
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'prompts'), {
                        ...formData, fullPrompt: generatedResult.singleLine, status: 'Idea', scheduledDate: '', createdAt: new Date().toISOString()
                    });
                    showToast('Disimpan ke Content Plan');
                } catch(e) { showToast('Error saving', 'error'); } 
                finally { setIsSaving(false); }
            };

            const handleAddManualPrompt = async (data) => {
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'prompts'), {
                        subject: data.subject, fullPrompt: data.description, platform: data.platform,
                        status: 'Idea', scheduledDate: '', createdAt: new Date().toISOString(), aiModel: 'Manual'
                    });
                    showToast('Ide baru ditambahkan');
                } catch(e) { showToast('Gagal menambah ide', 'error'); }
            };

            const handleUpdateStatus = async (id, data) => {
                try { await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'prompts', id), data); showToast('Updated!'); } 
                catch(e) { showToast('Update failed', 'error'); }
            };

            const confirmDelete = async () => {
                if (!deleteTargetId) return;
                try {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'prompts', deleteTargetId));
                    showToast('Konten dihapus');
                } catch (error) { showToast('Gagal menghapus', 'error'); } 
                finally { setDeleteTargetId(null); }
            };

            return (
                <div className="w-full min-h-screen font-sans bg-black text-gray-200 p-4 md:p-8">
                    <div className="max-w-7xl mx-auto">
                        <div className="flex flex-col items-center mb-6">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="p-3 bg-gradient-to-br from-orange-600 to-red-600 rounded-2xl shadow-lg">
                                    <Dumbbell className="text-white" size={32} />
                                </div>
                                <div className="text-left">
                                    <h1 className="text-2xl font-black tracking-tighter text-white">HUDAN <span className="text-orange-500">CONTENT</span></h1>
                                    <p className="text-[10px] uppercase tracking-widest text-gray-500">Plan & Generator</p>
                                </div>
                            </div>
                            <NavigationTabs activeTab={activeTab} setActiveTab={setActiveTab} />
                        </div>

                        {activeTab === 'generator' && <GeneratorView formData={formData} handleInputChange={handleInputChange} handleGenerate={handleGenerate} generatedResult={generatedResult} isSaving={isSaving} handleSave={handleSave} copyToClipboard={copyToClipboard} />}
                        {activeTab === 'plan' && <ContentPlanView prompts={prompts} onUpdateStatus={handleUpdateStatus} onDelete={(id) => setDeleteTargetId(id)} onAddManual={handleAddManualPrompt} />}
                        {activeTab === 'calendar' && <CalendarView prompts={prompts} />}
                    </div>

                    {/* Delete Modal */}
                    {deleteTargetId && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
                            <div className="bg-gray-900 border-2 border-red-900/50 rounded-2xl p-6 w-full max-w-sm">
                                <h3 className="text-xl font-bold text-white mb-2 text-center">Hapus Konten?</h3>
                                <div className="flex gap-3 w-full mt-6">
                                    <button onClick={() => setDeleteTargetId(null)} className="flex-1 py-3 bg-gray-800 rounded-xl font-bold">Batal</button>
                                    <button onClick={confirmDelete} className="flex-1 py-3 bg-red-600 text-white rounded-xl font-bold">Hapus</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Toast */}
                    {toast && (
                        <div className={`fixed bottom-5 right-5 z-50 px-6 py-4 rounded-xl shadow-2xl text-white ${toast.type === 'error' ? 'bg-red-500' : 'bg-emerald-500'}`}>
                            <div className="flex items-center gap-3"><CheckCircle size={20} /><span className="font-semibold">{toast.message}</span></div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
